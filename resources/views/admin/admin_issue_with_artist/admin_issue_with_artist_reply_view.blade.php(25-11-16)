<?php
$successmsg='';$errormsg='';
if(!empty($successmsgdata))
{
$successmsg=$successmsgdata;
}

if(!empty($errormsgdata))
{
$errormsg=$errormsgdata;
}

?>
<?php

if(!empty($pagi_country))
	{
		$id=$pagi_country->id;
		$complained_by=$pagi_country->dispute_opener_id;
		$gig_id=$pagi_country->gig_id;
		$gig_unique_id=$pagi_country->gig_unique_id;
		$dispute_type=$pagi_country->dispute_type;
		$gig_name=$pagi_country->gig_name;
		$description=$pagi_country->issue_description;
		$leave_early=$pagi_country->leave_early;
		$arrival_time=$pagi_country->arrival;
		$receive_rider=$pagi_country->receive_rider;
		$technical_issue=$pagi_country->technical_issue;
		$able_to_complete=$pagi_country->able_to_complete;
		$required_specifications_availability=$pagi_country->required_specifications_availability;
	}
?>
@extends('layouts.admin.adminmaster',['successmsg' => $successmsg,'errormsg'=>$errormsg])
@section('content')
<div class="padding-md">
<div class="row">
<div class="col-md-8 col-md-offset-2">
<div class="panel panel-default">
<div class="panel-heading">
Issue with artist reply section
</div>
	<!--here all the replys listing-->
	<div class="panel-body">
	
		<div id="reply_responce">
			@if(count($reply_messeges) > 0)
				<?php $i = 0;?>
				@foreach($reply_messeges as $all_reply)
					<?php $i++?>
					<h4>{{$all_reply->reply_by_user}}</h4>
					<span>{{date('d M Y , h:i A', strtotime($all_reply->reply_date))}}</span>
					<div class="seperator"></div>
					<div class="seperator"></div>
					<p>{{ucwords($all_reply->reply_content)}}</p><hr></hr>
						
				@endforeach
				<div style="display:none" id="last_row" data-row="{{$i}}"></div>
			@endif
		</div>
		<div id="loadDiv">
			
		</div>
	</div>
	<!--here all the replys listing end-->
	<div class="from-group" >
		<input type="hidden" name="total_data" id="total_data" value="{{$total_data}}">
		<input type="hidden" name="limit" id="limit" value="4">
		@if($total_data > 4)
		<button type="button" id="load" class="btn btn-default btn-sm bounceIn animation-delay5" style="align:centre">load previous</button><hr></hr>
	   @endif
	</div>
	
<div class="panel-body">
<?php
echo Form::open(array('url' => '','method' =>'post','id'=>'formdisputeid','class'=>"form-horizontal form-border no-margin" ));?>

					<!--Reply Section Div -->
<div class="form-group row" id="div_open_hide">
    <div class="form-group row">
        <label class="control-label col-sm-6">Select recipients to reply:</label>
            <div class="col-sm-6">
            
            <?php
                $attrbar = array();
                $attrbar['class'] = "control-label";
            ?>
            {{ Form::label('booker_email','Booker email',$attrbar)}}
            
           <!-- Booker email-->
            <?php
                $attrbar = array();
                $attrbar['id'] = "booker_id";
                $attrbar['class'] = "email";
            ?>
           {{ Form::checkbox('booker_email', $complained_by,null,$attrbar) }}
               
           
             <span class="custom-checkbox"></span>
            
             <?php
                $attrbar = array();
                $attrbar['class'] = "control-label";
            ?>
            {{ Form::label('artist_email','Artist email',$attrbar)}}
           <!-- Artist email-->
            <?php
                $attrbar = array();
                $attrbar['id'] = "artist_id";
                $attrbar['class'] = "email";
            ?>    
            {{ Form::checkbox('artist_email', stripslashes($pagi_country->artist_id),null,$attrbar) }}  
               
                 <span class="custom-checkbox"></span>
            
              
            </div>
    </div>

    <div class="form-group row" id="div_open_hide">
        <label class="control-label col-lg-2">Reply Content</label>
            <div class="col-sm-10">
                <textarea id="description" class="form-control input-sm " name="description" cols="50" rows="10"></textarea>		
                    <span  class="errorcustclass"></span>	
            </div>
    </div>
</div>
    
<input type="hidden" name="resolve_dispute_id" id="resolve_dispute_id" value="{{$id}}">
<input type="hidden" id="gig_id" value="{{$gig_id}}">
<input type="hidden" id="gig_unique_id" value="{{$gig_unique_id}}">
<input type="hidden" id="dispute_type" value="{{$dispute_type}}">

<!--Reply Section div closes-->
</div>
<div class="panel-footer">

    <a class="btn btn-warning" href="<?php echo  url(ADMINSEPARATOR.'/view_artist/'.$id);?>"><i class="fa fa-chevron-left"></i> Back</a>
    
    <button type="button" id="disputeartistreply" class="btn btn-success btn-sm bounceIn animation-delay5  pull-right">Submit</button>
</div> 
<?php
echo Form::close();
?>
</div>
</div>
</div>
</div>
@endsection
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script type="text/javascript">

$(document).ready(function () {
        
        $(document).on('click','#disputeartistreply',function(){
             
            var description_field = $("#description").val();
            if(description_field === "undefined" || description_field === ""){
                    alert ('Description field cannot remail blank!');
            }
                        
            var booker_ID = '';
            
            if($("input[name^=booker_email]:checked")){
            
                booker_ID = $("input[name^=booker_email]:checked").val();	//  $("#booker_email").val();
            }
                    
            var artist_ID = '';
            
            if($("input[name^=artist_email]:checked")){
                
                artist_ID = $("input[name^=artist_email]:checked").val();
            }
        
            if((jQuery.type(artist_ID) === "undefined") && (jQuery.type(booker_ID) === "undefined")){
                
                alert ('You didn\'t choose any of the checkboxes!');
            }
            else{
              
                var description=$("#description").val();
                var resolve_dispute_id=$("#resolve_dispute_id").val();
                var gig_id=$("#gig_id").val();
                var booker_id=$("#booker_id").val();
                var artist_id=$("#artist_id").val();
                var gig_unique_id=$('#gig_unique_id').val();
                var url= "<?php echo url(ADMINSEPARATOR.'/reply');?>";
				
                var last_row = $("#last_row").data('row');
				
                var snddata = {_token:"<?php echo csrf_token(); ?>",description:description,resolve_dispute_id:resolve_dispute_id,gig_id:gig_id,gig_unique_id:gig_unique_id,booker_id:booker_id,artist_id:artist_id,booker_ID:booker_ID,artist_ID:artist_ID,last_row:last_row};
				var respdata;
                console.log(snddata);
                
                $.ajax({
                	    url:url,
                		type:"POST",
                		data:snddata,
						dataType:'json',
                		success:function(d)
                		{
                            console.log(d);
							respdata=d.reply_content;
							$('#loadDiv').html(' ');
							$('#limit').val('4');
							$("#reply_responce").html(respdata);
							if($("#load").is(":hidden")){
								$('#load').show();	
							}
                            $('#booker_id').attr('checked', false);
                            $('#artist_id').attr('checked', false);
                            $('#description').val(' ');
                		}
                	});
            }
        });
		//load more
		$('#load').click(function(){
            var respdata = '';
            var total_data = $('#total_data').val();
            var limit = $('#limit').val();
            var next_limit = +limit+4;
			var resolve_dispute_id=$("#resolve_dispute_id").val();
			var url= "<?php echo url(ADMINSEPARATOR.'/load-more');?>";
			
            //alert(total_data+'  '+limit+'  '+next_limit);
            
            $.ajax({
                        url:url,
                        type: "POST",
						dataType:'json',
                        data:{'limit':limit,'resolve_dispute_id':resolve_dispute_id,'_token':$('meta[name="csrf-token"]').attr('content')},
                        success:function(d){
                            
							respdata=d.reply_content;
							console.log(respdata);
							$('#loadDiv').append(respdata);
                                if (total_data > next_limit ){
                                        $('#load').show();	
                                }
                                else{
                                        $('#load').hide();
                                }
                                $('#limit').val(next_limit);
                                //$('#append_form').html(data);  
                        }
                });
        });
    });
  
</script>

